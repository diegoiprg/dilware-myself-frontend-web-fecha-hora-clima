"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{7475:(e,t,a)=>{a.d(t,{SettingsProvider:()=>o,t:()=>c});var r=a(5155),n=a(2115);let s="chronos-settings",l={tempUnit:"C",timeFormat:"24h",showSeconds:!0,refreshInterval:10},i=(0,n.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,n.useState)(l);return(0,n.useEffect)(()=>{try{let e=window.localStorage.getItem(s);if(e){let t=JSON.parse(e);o(e=>({...e,...t}))}}catch(e){console.error("Error reading settings from localStorage",e)}},[]),(0,n.useEffect)(()=>{try{window.localStorage.setItem(s,JSON.stringify(a))}catch(e){console.error("Error saving settings to localStorage",e)}},[a]),(0,r.jsx)(i.Provider,{value:{...a,setTempUnit:e=>o(t=>({...t,tempUnit:e})),setTimeFormat:e=>o(t=>({...t,timeFormat:e})),setShowSeconds:e=>o(t=>({...t,showSeconds:e})),setRefreshInterval:e=>o(t=>({...t,refreshInterval:e}))},children:t})},c=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e}},7481:(e,t,a)=>{a.d(t,{dj:()=>f});var r=a(2115);let n=0,s=new Map,l=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function u(e){c=i(c,e),o.forEach(e=>{e(c)})}function d(e){let{...t}=e,a=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:a});return u({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},8460:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var r=a(5155),n=a(2115),s=a(2900);let l=()=>{let[e,t]=(0,n.useState)(new Date);return(0,n.useEffect)(()=>{let e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),e};var i=a(7481),o=a(7475);let c=()=>{let[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(null),[s,l]=(0,n.useState)(!0),{toast:c}=(0,i.dj)(),{refreshInterval:u}=(0,o.t)(),d=(0,n.useCallback)(async(e,t)=>{let a=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(t,"&localityLanguage=es"));if(!a.ok)throw Error("Reverse geocode response not OK");let r=await a.json();if(r){var n,s,l;let e={},t=null==(l=r.localityInfo)||null==(s=l.informative)||null==(n=s.find(e=>"street"===e.description))?void 0:n.name;t&&(e.street=t),r.locality&&(e.locality=r.locality),r.city&&(e.city=r.city),r.principalSubdivision&&(e.subdivision=r.principalSubdivision),r.countryName&&(e.country=r.countryName);let a=[e.street,e.locality,e.city,e.subdivision,e.country].filter((e,t,a)=>e&&a.indexOf(e)===t);if(a.length>0)return a.join(", ")}throw Error("No location parts found")},[]),f=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l(!0),r(null);let a="user-location";try{let r;if(!e){let e=localStorage.getItem(a);if(e){let{timestamp:a,data:r}=JSON.parse(e);if(Date.now()-a<6e5){t(r),l(!1);return}}}try{let{latitude:e,longitude:t}=(await new Promise((e,t)=>{if(!("geolocation"in navigator))return t(Error("Geolocation not supported"));navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})).coords,a=await d(e,t);r={latitude:e,longitude:t,displayName:a}}catch(n){c({title:"No se pudo usar la geolocalizaci\xf3n.",description:"Usando ubicaci\xf3n por IP como alternativa.",variant:"default"});let e=await fetch("https://ipapi.co/json/");if(!e.ok)throw Error("IP API response not OK");let t=await e.json();if(!t.latitude||!t.longitude)throw Error("IP API did not return coordinates");let a=[t.city,t.region,t.country_name].filter(Boolean).join(", ")||"Ubicaci\xf3n desconocida";r={latitude:t.latitude,longitude:t.longitude,displayName:a}}t(r),localStorage.setItem(a,JSON.stringify({timestamp:Date.now(),data:r}))}catch(t){let e="Location N/A";t instanceof Error&&(e=t.message),r(e),c({title:"Error al obtener la ubicaci\xf3n",description:e,variant:"destructive"})}finally{l(!1)}},[c,d]);return(0,n.useEffect)(()=>{f()},[f]),(0,n.useEffect)(()=>{if(u>0){let e=setInterval(()=>{f(!0)},60*u*1e3);return()=>clearInterval(e)}},[u,f]),{location:e,error:a,loading:s}};var u=a(7358);let d=(e,t)=>{let[a,r]=(0,n.useState)(null),[s,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),{toast:f}=(0,i.dj)(),{refreshInterval:m}=(0,o.t)(),p=(0,n.useCallback)(async()=>{if(e&&t){d(!0),l(null);try{let a=await fetch("".concat(u.env.NEXT_PUBLIC_WEATHER_API_BASE||"https://api.open-meteo.com/v1/forecast","?latitude=").concat(e,"&longitude=").concat(t,"&current=temperature_2m,relative_humidity_2m,uv_index,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=auto"));if(!a.ok)throw Error("Weather response not OK");let n=await a.json();if((null==n?void 0:n.current)&&(null==n?void 0:n.daily)){let e={temperature:n.current.temperature_2m,minTemperature:n.daily.temperature_2m_min[0],maxTemperature:n.daily.temperature_2m_max[0],humidity:n.current.relative_humidity_2m,uvIndex:n.current.uv_index,weatherCode:n.current.weather_code};r(e)}else throw Error("Invalid weather data structure")}catch(t){let e="Temp. N/A";t instanceof Error&&(e="".concat(e,": ").concat(t.message)),l(e),f({title:"Error al obtener el clima",description:t instanceof Error?t.message:"Error desconocido",variant:"destructive"})}finally{d(!1)}}},[e,t,f]);return(0,n.useEffect)(()=>{p()},[p]),(0,n.useEffect)(()=>{if(m>0){let e=setInterval(()=>{p()},60*m*1e3);return()=>clearInterval(e)}},[m,p]),{weather:a,error:s,loading:c}},f=()=>(0,r.jsx)("main",{className:"bg-background text-foreground h-[100svh] w-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"font-headline text-2xl animate-pulse",children:"Loading..."})}),m=(0,n.lazy)(()=>a.e(382).then(a.bind(a,7382)).then(e=>({default:e.Clock}))),p=(0,n.lazy)(()=>Promise.all([a.e(426),a.e(210),a.e(747)]).then(a.bind(a,3747)).then(e=>({default:e.SettingsPanel}))),h=(0,n.lazy)(()=>a.e(38).then(a.bind(a,4038)).then(e=>({default:e.DateDisplay}))),v=(0,n.lazy)(()=>a.e(529).then(a.bind(a,3529)).then(e=>({default:e.LocationDisplay}))),y=(0,n.lazy)(()=>a.e(409).then(a.bind(a,4409)).then(e=>({default:e.WeatherDisplay})));function g(){let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(null),i="undefined"!=typeof document&&!!document.fullscreenEnabled,o="undefined"!=typeof navigator&&"wakeLock"in navigator,u=l();(0,n.useEffect)(()=>{if(!o)return;let e=async()=>{if(document.fullscreenElement)try{let e=await navigator.wakeLock.request("screen");a(e)}catch(e){console.error("Wake lock request failed",e)}else t&&(t.release(),a(null))};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e),t&&t.release()}},[t,o]);let{location:g,error:w,loading:S}=c(),{weather:E,error:_,loading:x}=d(null==g?void 0:g.latitude,null==g?void 0:g.longitude);return!u||S?(0,r.jsx)(f,{}):(0,r.jsx)("div",{ref:e,className:"bg-background text-foreground h-screen w-screen select-none overflow-hidden pt-[env(safe-area-inset-top)] pl-[env(safe-area-inset-left)] pr-[env(safe-area-inset-right)] pb-[env(safe-area-inset-bottom)]",children:(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)(f,{}),children:(0,r.jsxs)(s.P.div,{className:"h-full w-full max-w-none mx-auto grid ".concat(E||x?"grid-rows-[1fr_1fr_3fr_1fr_1fr]":"grid-rows-[1fr_1fr_3fr_2fr]"," landscape:grid-rows-[1fr_3fr_1fr] landscape:grid-cols-2 place-items-center p-2 sm:p-4 md:p-6 lg:p-8"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[(0,r.jsx)("div",{className:"flex items-center gap-4 justify-self-center landscape:col-start-2 landscape:row-start-1 landscape:justify-self-end",children:(0,r.jsx)(p,{appVersion:"v1.5.0"})}),(0,r.jsx)("div",{className:"justify-self-center landscape:col-start-1 landscape:row-start-1 landscape:justify-self-start",children:(0,r.jsx)(h,{date:u})}),(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center max-w-[90%] landscape:col-span-2 landscape:row-start-2",children:(0,r.jsx)(m,{time:u,onClick:()=>{if(!i)return;let e=document.documentElement;document.fullscreenElement?document.exitFullscreen():e.requestFullscreen().catch(()=>{})},isFullscreenSupported:i})}),(0,r.jsx)("div",{className:"landscape:col-start-1 landscape:row-start-3 landscape:self-end ".concat(E||x?"landscape:justify-self-start":"landscape:col-span-2 landscape:justify-self-center"),children:(0,r.jsx)(v,{displayName:null==g?void 0:g.displayName})}),(E||x)&&(0,r.jsx)("div",{className:"justify-self-center landscape:col-start-2 landscape:row-start-3 landscape:justify-self-end landscape:self-end",children:(0,r.jsx)(y,{weather:E,loading:x,error:_||w})})]})})})}}}]);